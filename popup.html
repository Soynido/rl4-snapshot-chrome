<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>RL4 Snapshot</title>
  <link rel="stylesheet" href="styles/popup.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="header-brand">
        <div class="logo-wrap" aria-hidden="true">
          <img src="icons/logo.png" alt="RL4 Logo" class="logo-img" />
        </div>
        <div class="header-text">
          <h1>RL4 Snapshot</h1>
          <p class="subtitle">RCEPâ„¢ context â€¢ Claude + ChatGPT + Gemini â€¢ Save context â†’ reuse anywhere</p>
        </div>
      </div>
      <div class="header-actions">
        <button id="reloadBtn" class="btn-inline btn-reload" type="button" title="Reset UI for a new run">
          Reload
        </button>
        <!-- Busy indicator (top-right) -->
        <div id="busySpinner" class="busy-spinner hidden" aria-hidden="true"></div>
      </div>
    </header>
    
    <main>
      <div id="stepper" class="stepper" aria-label="Workflow progress">
        <div class="stepper-row">
          <span id="stepLabel" class="stepper-label">Step 1/4</span>
          <span id="stepHint" class="stepper-hint">Generate a snapshot</span>
        </div>
        <div class="stepper-bar" aria-hidden="true">
          <div id="stepperFill" class="stepper-fill" style="width: 25%"></div>
        </div>
      </div>

      <div id="stage" class="stage">
        <!-- Step 1: options + generate -->
        <div id="stageStep1" class="stage-panel">
      <div id="optionsWrap" class="options">
        <div class="options-head">
          <span class="options-title">Options</span>
          <button id="optionsToggleBtn" class="btn-inline btn-toggle" type="button" aria-expanded="false">
            Show
          </button>
        </div>
        <div id="optionsBody" class="options-body hidden">
              <div class="options-group" role="group" aria-label="Snapshot mode">
                <div class="options-group-title">Mode</div>

                <label class="option-row">
                  <input id="modeCompact" name="snapshotMode" type="radio" checked />
                  <span class="option-text">
                    <strong>Compact</strong>
                    <span class="option-sub">Small, structured snapshot (recommended)</span>
                  </span>
          </label>

                <label class="option-row">
                  <input id="modeUltraPlus" name="snapshotMode" type="radio" />
                  <span class="option-text">
                    <strong>Compact + Meaning (Ultra+)</strong>
                    <span class="option-sub">Adds tiny summary + checklist (no transcript)</span>
                  </span>
          </label>

                <label class="option-row">
                  <input id="modeTranscript" name="snapshotMode" type="radio" />
                  <span class="option-text">
                    <strong>Full transcript</strong>
                    <span class="option-sub">Best fidelity, can be too large</span>
                  </span>
          </label>
              </div>

              <div class="options-group" role="group" aria-label="Integrity">
                <div class="options-group-title">Integrity</div>
                <label class="option-row">
            <input id="integritySeal" type="checkbox" checked />
                  <span class="option-text">
                    <strong>Tamper Seal (deviceâ€‘only)</strong>
                    <span class="option-sub">Detects edits after export</span>
                  </span>
          </label>
              </div>
        </div>
      </div>

      <button id="generateBtn" class="btn-primary">
            Generate Snapshot
      </button>
        </div>

        <!-- Status: reserved for progress/errors (not for step labels) -->
      <div id="status" class="status hidden"></div>
      
        <!-- Capture proof (shared across steps 2â€“4) -->
        <div id="captureProof" class="hidden">
      <div id="metadata" class="metadata hidden">
            <div class="metadata-head">
              <span class="metadata-title">Capture summary</span>
              <button id="metaToggleBtn" class="btn-inline btn-toggle" type="button" aria-expanded="false">
                Details
              </button>
        </div>
            <div class="meta-one-line">
              <span><strong id="messageCount">-</strong> msgs</span>
              <span class="meta-dot">â€¢</span>
              <span>compression <strong id="compressionRatio">-</strong></span>
              <span class="meta-dot">â€¢</span>
              <span>capture <strong id="captureCompleteness">-</strong></span>
              <span class="meta-dot">â€¢</span>
              <span>checksum <strong id="checksum" class="checksum-short">-</strong></span>
        </div>
            <div id="metaDetails" class="meta-details hidden"></div>
        </div>
      </div>

        <!-- Step 2 -->
        <div id="stageStep2" class="stage-panel hidden">
        <button id="copyEncoderPromptBtn" class="btn-primary" type="button">
            Copy finalization prompt
          </button>
        </div>

        <!-- Step 3 -->
        <div id="stageStep3" class="stage-panel hidden">
          <div id="rl4BlocksManual">
            <div class="field" style="margin-top: 8px;">
              <label class="field-label" for="rl4BlocksInput">Paste LLM response here</label>
              <textarea id="rl4BlocksInput" class="input" rows="6" placeholder="Paste the assistant reply containing <RL4-ARCH>â€¦</RL4-ARCH> etc."></textarea>
            </div>
            <button id="finalizeBlocksBtn" class="btn-primary" type="button" disabled>
              Finalize Snapshot
            </button>
          </div>
        </div>

        <!-- Step 4 -->
        <div id="stageStep4" class="stage-panel hidden">
          <button id="copyPromptBtn" class="btn-primary" type="button" disabled>
            Copy Final Prompt
        </button>
        </div>
      </div>

      <!-- Persistent "last prompt" (survives popup close/reopen) -->
      <div id="lastPrompt" class="last-prompt hidden">
        <div class="last-prompt-head">
          <span class="last-prompt-title">Last prompt</span>
          <button id="toggleLastPromptBtn" class="btn-inline btn-toggle" type="button" aria-expanded="false">
            Show
          </button>
          <button id="copyLastPromptBtn" class="btn-inline" type="button">ðŸ“‹ Copy</button>
        </div>
        <div class="last-prompt-hint">Your last final prompt is saved here.</div>
        <pre id="lastPromptText" class="last-prompt-text"></pre>
      </div>

    </main>
    
    <footer>
      <span class="link-subtle">Crossâ€‘LLM context, made simple.</span>
    </footer>
  </div>
  
  <script src="lib/checksum.js"></script>
  <script src="lib/extraction.js"></script>
  <script src="lib/cognitive-splitter.js"></script>
  <script src="lib/causal-linker.js"></script>
  <script src="lib/progressive-summarizer.js"></script>
  <script src="lib/snapshot.js"></script>
  <script src="popup.js"></script>
</body>
</html>

